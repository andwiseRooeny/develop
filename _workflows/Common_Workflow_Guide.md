# 워크플로우 공통 개발 가이드 (Common Workflow Guide)

이 문서는 프로젝트 내의 모든 워크플로우(`.agent/workflows/*.md`)가 공통적으로 추구해야 할 표준 방향성과 구현 규칙을 정의합니다. 새로운 워크플로우를 작성하거나 기존 워크플로우를 수정할 때 이 가이드를 지침으로 사용하십시오.

---

## 1. 초기화 및 절대 준수 (Step 0: Bootstrapping)

모든 워크플로우의 **0번째 단계**는 지식의 세계관을 동기화하고 실행 환경을 확보하는 과정입니다. 이 단계는 건너뛰거나 생략할 수 없는 **절대적 의무 사항(Critical Mandate)**입니다.

**구현 표준:**
```markdown
0. **[헤더 참조 및 세계관 동기화] (CRITICAL)**
   - 워크플로우 상단에 정의된 모든 **Header(참조 문서)**를 식별하고, 해당 파일들을 반드시 `view_file` 도구로 열어 내용을 확인합니다.
   - 각 문서에 정의된 규칙, 명명법, 분류 체계 등의 **세계관(Worldview)**을 완벽히 숙지하고 이를 절대적으로 준수하여 업무를 수행합니다.

0-1. **[프로젝트 루트 확인]**
   - 실행 전 반드시 `_develop/_info/Project_Root.md` 파일이 존재하는지 확인합니다.
   - 만약 파일이 없다면 사용자에게 "현재 개발 디렉토리 경로"를 질문하여 답변을 받은 후, `_develop/_info/Project_Root.md` 파일을 생성하고 해당 경로를 기록합니다.
   - (선택) 확보된 루트 경로를 기준으로 이후 단계의 모든 경로(`_ref`, `_info`)를 상대 경로로 계산합니다.
```

## 2. 경로 관리 원칙 (Path Management)

모든 워크플로우와 생성되는 문서는 **환경 독립성(Environment Independence)**을 보장해야 합니다. 개인 PC의 절대 경로가 포함되는 순간 협업과 이식성이 깨집니다.

### 2.1 문서 간 링크 규칙 (Markdown Link)
- **원칙**: 현재 파일 위치를 기준으로 하는 **상대 경로(Relative Path)**만 허용합니다.
- **포맷**: `./파일명.md` 또는 `../폴더/파일명.md`
- **예시**:
  - ❌ `[링크](file:///c:/dev/workspace/u1/fox/src/main/_develop/_ref/guide.md)` (절대 경로 금지)
  - ✅ `[링크](./guide.md)` (같은 폴더 내)
  - ✅ `[링크](../_info/Project_Root.md)` (다른 폴더 참조)

### 2.2 소스 코드 참조 규칙 (Source Path)
- **원칙**: 프로젝트의 최상위 루트(`src/main/...`)를 기준으로 하는 경로만 기재합니다.
- **예시**:
  - ❌ `C:\dev\workspace\u1\fox\src\main\java\com\test\App.java`
  - ✅ `src/main/java/com/test/App.java`

### 2.3 시스템 경로 처리
- 워크플로우 내부 로직에서 절대 경로가 필요한 경우, 반드시 **Step 0에서 확보한 Project Root** 변수와 결합하여 동적으로 생성해야 합니다. 하드코딩된 절대 경로는 사용할 수 없습니다.

## 3. 지식 관리 체계 (Knowledge Base Structure)

워크플로우는 프로젝트의 지식을 `_develop` 디렉토리 하위에 체계적으로 관리해야 합니다.

- **`_develop/_info/`**: 프로젝트의 구조적 정보, 디렉토리 역할, 작업 현황 등을 기록합니다. (Fact Base)
- **`_develop/_ref/`**: 기술적 레퍼런스, 구현 가이드, 핵심 노하우 등을 기록합니다. (Knowledge Base)
- **`_develop/_lib/`**: 실전 작업에서 생성된 문제 해결 경험과 레퍼런스 조합을 기록합니다. (Context Base)
- **`_develop/_ing/`**: 현재 진행 중인 작업의 상태(Task, Log, Context)를 실시간으로 기록합니다. (Status Base)
- **`_develop/_result/`**: 작업이 완료된 산출물을 패치 형태로 백업/저장합니다. (Artifact Base)

**규칙:**
- 워크플로우는 이 5개 폴더 외의 공간에 임의의 메타데이터를 저장하지 않습니다.
- 모든 지식은 누구나 읽을 수 있는 **Markdown** 형식으로 저장되어야 합니다.

## 4. 맥락 격리 및 내부 지식 우선 (Context Isolation)

워크플로우 실행 시, AI는 외부의 일반적인 지식보다는 **프로젝트 내부에 축적된 `_develop` 문서들을 최우선 진실(Ground Truth)**로 취급해야 합니다.

- **원칙**: "이 파일에 따르면", "이 레퍼런스 문서에 의거하여"와 같이 근거를 명시하는 것을 권장합니다.
- 특히 **구현/수정** 관련 워크플로우에서는 `_develop/_ref`에 정의된 패턴을 벗어난 코드를 생성하지 않도록 강력한 제약을 걸어야 합니다.

## 5. 분석 및 컨텍스트 확보 원칙 (Analysis & Context)

지식 생성 및 레퍼런스 작성을 수행하는 분석형 워크플로우는 다음의 정보를 반드시 종합적으로 고려하고 수집해야 합니다.

- **소스 수집 (Source Collection)**:
  - **파일**: `read_file`로 내용을 읽습니다. (복수 파일 시 모두 읽어 전체 컨텍스트 확보)
  - **폴더**: `list_dir`로 구조를 파악하고, 핵심 파일(예: Controller, Service, XML 등)을 우선 선별하여 읽습니다.
  - **코드블록/텍스트**: 사용자가 프롬프트에 직접 입력하거나 붙여넣은 내용을 최우선 분석 텍스트로 포함합니다.

- **통합 분석 (Integrated Analysis)**:
  - 수집된 모든 정보(파일 내용 + 코드블록 + 폴더 구조)를 개별적으로 보지 않고, 하나의 유기적인 시스템으로 통합하여 핵심 기술과 비즈니스 로직을 파악합니다.

## 6. 사용자 상호작용 및 문서 형식

- **언어**: 모든 프롬프트, 질문, 생성 문서는 **한국어**를 기본으로 합니다.
- **가독성**: 
  - 긴 줄글 대신 **개조식(Bullet points)**과 **헤더(#)**를 활용합니다.
  - 핵심 키워드는 `**볼드**` 처리하여 시인성을 높입니다.
- **선택권 부여**: 여러 가지 옵션이 가능한 경우, 사용자에게 옵션을 제안하고(예: 복수 선택) 그에 따라 분기 처리하는 패턴을 권장합니다.
- **Turbo 모드**: 파일 열기(`view_file`) 등 부가적인 편의 기능이나 단순 반복 작업은 `// turbo` 어노테이션을 활용하여 자동화 단계를 추가합니다.

## 7. 워크플로우 작성 체크리스트

- [ ] **Step 0**에 `Project_Root` 확인 로직이 있는가?
- [ ] 생성되는 문서가 `_develop` 하위의 적절한 폴더(`_info`, `_ref`, `_lib` 등)에 위치하는가?
- [ ] 파일 경로는 상대 경로로 처리되는가?
- [ ] **소스 수집 시** 폴더 구조와 파일 내용을 복합적으로 분석하는가?
- [ ] 사용자에게 명확한 한국어 가이드를 제공하는가?
- [ ] 실행 완료 후 생성된 파일을 사용자에게 보여주는가?
